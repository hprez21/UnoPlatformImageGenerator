<Page x:Class="ImageGenerator.Presentation.ThirdPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:ImageGenerator.Presentation"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:uen="using:Uno.Extensions.Navigation.UI"
      xmlns:utu="using:Uno.Toolkit.UI"
      xmlns:um="using:Uno.Material"
      xmlns:lottie="using:CommunityToolkit.WinUI.Lottie"
      xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
      Background="{ThemeResource BackgroundBrush}">

  <Grid Padding="24,24,0,0">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>
    
    <!-- Title Section -->
    <StackPanel Grid.Row="0" VerticalAlignment="Center" Spacing="12">
      <StackPanel Orientation="Horizontal" Spacing="4">
        <TextBlock x:Name="TitleText"
                   Text="Generating"
                   Style="{StaticResource HeadlineMedium}"
                   Foreground="{ThemeResource OnBackgroundBrush}"
                   FontWeight="Bold"/>
        <TextBlock x:Name="DotsText"
                   Text=""
                   Style="{StaticResource HeadlineMedium}"
                   Foreground="{ThemeResource OnBackgroundBrush}"
                   FontWeight="Bold"/>
      </StackPanel>
      
      <!-- Time Spent Row -->
      <StackPanel Orientation="Horizontal" Spacing="4">
        <TextBlock Text="Time spent "
                   Style="{StaticResource BodyLarge}"
                   Foreground="{ThemeResource OnSurfaceVariantBrush}"
                   VerticalAlignment="Center"/>
        
        <!-- Timer with highlight animation -->
        <Grid>
          <Border x:Name="TimerHighlight"
                  Background="#E8FF8E"
                  CornerRadius="5"
                  Opacity="0"
                  Padding="8,4">
            <TextBlock x:Name="TimerText"
                       Text="0"
                       Style="{StaticResource BodyLarge}"
                       Foreground="#101216"
                       VerticalAlignment="Center"/>
          </Border>
          <TextBlock x:Name="TimerTextNormal"
                     Text="0"
                     Style="{StaticResource BodyLarge}"
                     Foreground="{ThemeResource OnSurfaceVariantBrush}"
                     VerticalAlignment="Center"
                     Padding="8,4"/>
        </Grid>
        
        <TextBlock Text=" Seconds"
                   Style="{StaticResource BodyLarge}"
                   Foreground="{ThemeResource OnSurfaceVariantBrush}"
                   VerticalAlignment="Center"/>
      </StackPanel>
    </StackPanel>
    
    <!-- Image/Animation Area -->
    <Grid Grid.Row="1" Margin="0,24,24,24"
          HorizontalAlignment="Center"
          VerticalAlignment="Center">
      <!-- Generated Image (hidden initially) -->
      <Border x:Name="ImageBorder"
              CornerRadius="20"
              Opacity="0">
        <Image x:Name="GeneratedImage" 
               Source="ms-appx:///Assets/cartoon.jpg" 
               Stretch="Uniform"/>
      </Border>
      
      <!-- Yellow overlay animation -->
      <Border x:Name="ImageAnimation"
              Background="#E8FF8E"
              CornerRadius="20"
              Opacity="0"/>
      
      <!-- Lottie Animation (Robot loading) -->
      <muxc:AnimatedVisualPlayer x:Name="LottiePlayer"
                                  AutoPlay="True"
                                  Stretch="Uniform"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center">
        <lottie:LottieVisualSource x:Name="LottieSource" 
                                    UriSource="ms-appx:///Assets/robot.json"/>
      </muxc:AnimatedVisualPlayer>
    </Grid>
    
    <!-- Finish Button -->
    <Button x:Name="FinishButton"
            Grid.Row="2"
            Command="{Binding Finish}"
            HorizontalAlignment="Center"
            Margin="0,0,24,32"
            Padding="64,20"
            CornerRadius="35"
            Background="#E8FF8E"
            RenderTransformOrigin="0.5,0.5">
      <Button.RenderTransform>
        <ScaleTransform x:Name="FinishButtonScale" ScaleX="0" ScaleY="0"/>
      </Button.RenderTransform>
      <TextBlock Text="Finish"
                 Style="{StaticResource TitleLarge}"
                 Foreground="#101216"
                 FontWeight="SemiBold"/>
    </Button>
  </Grid>
</Page>
